# 上线流程管理系统 - 使用说明

## 📖 系统概述

上线流程管理系统是一个专为运维工程师设计的上线流程辅助管理工具，帮助您高效地管理复杂的多环境、多服务部署过程。

### 🎯 核心功能

- **标准流程管理**: 自动生成标准化的9步上线流程
- **进度可视化**: 实时展示当前进度和步骤状态
- **智能提醒**: 基于流程状态动态生成待办事项
- **一键复制**: 快速生成标准格式通知消息
- **历史记录**: 完整保存所有上线记录，支持查看和导出
- **配置管理**: 集中管理服务配置和消息模板

---

## 🚀 快速开始

### 系统启动

1. **自动启动（推荐）**
   ```bash
   npm run dev
   ```

2. **手动启动**
   ```bash
   # 启动后端（端口3000）
   cd backend && npm start
   
   # 启动前端（端口3001）
   cd frontend && npm run dev
   ```

3. **访问系统**
   - 前端界面：http://localhost:3001
   - 后端API：http://localhost:3000

### 首次使用建议

1. 先查看**配置管理**页面，确认服务配置已正确导入
2. 浏览**历史记录**页面，了解系统功能
3. 在**流程管理**页面创建您的第一个上线任务

---

## 📱 功能模块详解

### 1. 首页看板 `/`

**功能概述**: 系统主控制台，显示当前状态和待办事项

#### 📊 数据展示
- **任务统计**: 总任务数、进行中任务、已完成任务、失败任务
- **当前任务**: 正在执行的任务详情
- **待办事项**: 基于当前进度自动生成的操作清单

#### 🎯 待办事项类型
- **操作事项** (`operate`): 需要执行的具体操作步骤
- **确认事项** (`confirm`): 需要确认完成的验证步骤

#### 💡 使用技巧
- 待办事项按优先级排序（高→中→低）
- 点击事项可直接跳转到对应的操作页面
- 实时更新，页面刷新后数据保持同步

---

### 2. 流程管理 `/task-flow`

**功能概述**: 创建和管理上线任务，执行具体的部署流程

#### 🔧 任务创建
1. 点击**"创建新任务"**按钮
2. 填写任务信息：
   - **任务名称**: 建议格式 `服务名-版本-日期`
   - **任务描述**: 详细说明本次上线的内容和目的
3. 系统自动生成标准9步流程

#### 📋 标准流程步骤
1. **准备阶段**: 代码准备和环境检查
2. **DS部署-国内IDC1-A组**: 数据服务第一组部署
3. **DS部署-国内IDC1-B组**: 数据服务第二组部署
4. **AB组流量切换**: 流量从A组切换到B组
5. **Service部署-国内IDC1**: 业务服务部署
6. **Service部署-国内IDC2**: 业务服务备份机房部署
7. **API部署**: 接口服务部署
8. **全面测试验证**: 功能和性能验证
9. **上线完成确认**: 最终确认和文档记录

#### ⚡ 步骤操作
- **开始步骤**: 点击播放按钮，自动记录开始时间
- **完成步骤**: 点击完成按钮，记录结束时间和实际耗时
- **添加备注**: 记录操作过程中的重要信息
- **一键复制**: 生成标准格式的通知消息

#### 📝 消息模板
系统提供4类标准消息模板：
- **部署开始通知**: DS/Service部署开始时发送
- **部署完成通知**: 单个服务部署完成时发送
- **流量切换通知**: AB组切换时发送
- **上线完成通知**: 整个任务完成时发送

#### 🔄 状态管理
- **待开始** (`pending`): 灰色，等待执行
- **进行中** (`in_progress`): 蓝色，正在执行
- **已完成** (`completed`): 绿色，执行成功
- **失败** (`failed`): 红色，执行失败
- **跳过** (`skipped`): 橙色，暂时跳过

---

### 3. 配置管理 `/configuration`

**功能概述**: 管理系统配置、服务信息和消息模板

#### 🛠️ 服务配置
显示所有已导入的服务配置，包含18个预配置服务：

**国内服务配置**:
- DS服务: IDC1/IDC2的A/B组配置
- SERVICE服务: IDC1/IDC2配置
- 管理地址: Jean平台链接

**国际服务配置**:
- 核心服务: IDC1/IDC2配置
- 爬虫服务: 混合部署配置
- API服务: 核心和非核心配置

#### ⚙️ 系统配置
- **部署通知群组**: 设置通知接收人
- **最大部署时间**: 超时提醒设置
- **自动回滚**: 是否启用故障自动回滚
- **部署环境**: 当前部署环境标识
- **健康检查超时**: 服务健康检查时间限制

#### 📧 消息模板管理
- **模板编辑**: 自定义消息格式和变量
- **变量支持**: 动态替换服务名、时间等信息
- **模板激活**: 启用/禁用特定模板

#### 💡 配置管理技巧
- 服务配置支持筛选和搜索
- 配置修改实时生效
- 模板变量使用 `${变量名}` 格式

---

### 4. 历史记录 `/history`

**功能概述**: 查看完整的上线历史记录，支持详情查看和数据导出

#### 📊 历史列表
- **任务信息**: 名称、状态、创建时间
- **执行统计**: 总步骤、已完成、失败数量、总耗时
- **分页浏览**: 支持翻页和每页条数设置

#### 🔍 详情查看
点击**"查看"**按钮可查看完整的任务执行详情：
- **任务基本信息**: 名称、描述、执行时间
- **步骤执行详情**: 每个步骤的状态、耗时、备注
- **消息记录**: 完整的通知消息历史
- **统计汇总**: 整体执行情况分析

#### 📤 数据导出
- **JSON格式**: 包含完整的任务、步骤、消息数据
- **结构化数据**: 便于后续数据分析和备份
- **一键导出**: 直接下载或复制到剪贴板

#### 📈 数据分析价值
- **效率分析**: 对比不同任务的执行时间
- **故障分析**: 查看失败任务的具体原因
- **流程优化**: 基于历史数据优化标准流程

---

## ⚡ 高效使用技巧

### 1. 工作流建议

**上线前准备**:
1. 检查配置管理中的服务信息是否最新
2. 确认消息模板符合团队规范
3. 在历史记录中回顾类似任务的执行经验

**执行过程中**:
1. 使用首页看板掌握全局进度
2. 及时添加步骤备注记录重要信息
3. 善用一键复制功能发送标准通知
4. 遇到问题及时更新步骤状态

**上线后总结**:
1. 确保所有步骤状态正确
2. 导出历史记录作为文档备份
3. 总结经验优化下次流程

### 2. 快捷键和操作

- **页面刷新**: 数据实时同步，可随时刷新
- **浏览器书签**: 建议收藏常用页面
- **多窗口操作**: 可同时打开多个页面对比查看

### 3. 故障处理

**常见问题及解决方案**:

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 页面空白 | 服务未启动 | 检查前后端服务状态 |
| 数据不更新 | 网络连接问题 | 刷新页面或检查网络 |
| 功能异常 | 浏览器缓存 | 清除缓存或使用无痕模式 |
| 配置丢失 | 数据库问题 | 重新运行数据导入脚本 |

---

## 📋 最佳实践

### 1. 命名规范

**任务命名**:
```
格式: [服务名]-[版本]-[日期]
示例: goods-ds-v2.1.0-20240625
```

**步骤备注**:
```
格式: [操作类型] [具体内容] [结果/异常]
示例: 部署 goods-ds-v2.1.0 成功，健康检查通过
```

### 2. 时间管理

- **预留时间**: 每个步骤预留10-20%的缓冲时间
- **关键节点**: 重要步骤完成后及时通知相关人员
- **回滚准备**: 为可能的回滚操作预留时间窗口

### 3. 团队协作

- **状态同步**: 及时更新步骤状态让团队了解进度
- **信息共享**: 重要备注和异常信息及时记录
- **经验传承**: 定期回顾历史记录总结最佳实践

### 4. 风险控制

- **分步验证**: 每个步骤完成后进行验证
- **回滚准备**: 关键节点设置回滚检查点
- **监控告警**: 结合现有监控系统观察服务状态

---

## 🔧 技术规格

### 系统架构
- **前端**: React 18 + TypeScript + Ant Design
- **后端**: Node.js + Express + TypeScript
- **数据库**: SQLite（轻量级，无需额外配置）
- **状态管理**: Redux Toolkit

### 性能特点
- **响应速度**: 本地部署，毫秒级响应
- **数据安全**: 本地存储，数据不外传
- **易扩展**: 模块化设计，易于功能扩展
- **低维护**: 无需复杂的环境依赖

### 兼容性
- **浏览器**: Chrome/Firefox/Safari/Edge (最新版本)
- **操作系统**: macOS/Windows/Linux
- **Node.js**: 16.x 及以上版本

---

## ❓ 常见问题

### Q: 如何备份数据？
A: 数据库文件位于 `backend/database/deployment-flow.db`，定期备份此文件即可。

### Q: 可以自定义流程步骤吗？
A: 当前版本使用固定的9步流程，未来版本将支持自定义流程模板。

### Q: 支持多人协作吗？
A: 当前版本为单用户设计，多人使用建议部署多个实例。

### Q: 如何清理历史数据？
A: 可以通过数据库管理工具或编写脚本清理 `tasks`、`task_steps`、`messages` 表。

### Q: 系统性能如何优化？
A: 定期清理历史数据、使用SSD存储、确保充足的内存空间。

---

## 📞 技术支持

如您在使用过程中遇到问题或有改进建议，请：

1. **查看日志**: 检查控制台输出的错误信息
2. **重启服务**: 尝试重启前后端服务
3. **检查环境**: 确认Node.js版本和依赖包状态
4. **数据备份**: 遇到严重问题前先备份数据

---

**祝您使用愉快！** 🎉

> 本系统专为运维效率而设计，让复杂的上线流程变得简单可控。 